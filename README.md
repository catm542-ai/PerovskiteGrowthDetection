# Perovskite Growth Experiment

This repository contains three Python scripts to control syringe pumps, capture automated photographs of a perovskite growth experiment, and analyze the resulting images to quantify growth over time.

## Table of Contents
1. [Overview](#overview)
2. [Software Environment and Requirements](#software-environment-and-requirements)
3. [Installation](#installation)
4. [Usage](#usage)
   - [1. Pump Control (`send_pump_commands.py`)](#1-pump-control-controlador_bombaspy)
   - [2. Automated Photo Capture (`auto_image_capture.py`)](#2-automated-photo-capture-captura_fotospy)
   - [3. Image Analysis (`PerovskiteGrowthAnalyzer.py`)](#3-image-analysis-analisis_imagenespy)
5. [Directory Structure](#directory-structure)
6. [Outputs](#outputs)
7. [License](#license)

## Overview

1. **Pump Control**  
   The script `send_pump_commands.py` connects to Tricontinent syringe pumps via serial (COM4, 9600 baud) and sends user-defined commands to set the flow rates and behaviors of the pumps.

2. **Automated Photo Capture**  
   The script `auto_image_capture.py` uses two cameras (IDs 0 and 1) to take photographs every 2 minutes, alternating between cameras, and saves them with timestamped filenames.

3. **Image Analysis**  
   The script `PerovskiteGrowthAnalyzer.py` processes all `.jpg` images in the working directory, crops a predefined region of interest, detects perovskite growth via color thresholds (yellow/green), computes contour areas over time, applies smoothing, and generates:
   - A PDF plot (`area_vs_time_plot.pdf`) of detected area vs. time
   - A text file (`area_vs_time_data.txt`) with time‐area pairs
   - A folder `processed_images/` containing annotated images

## Software Environment

- **Operating System:** Windows 11 Education, version 23H2 (build 22631.5335)
- **Python Interpreter:** CPython 3.10.9 via Spyder (Anaconda, `base` environment)
- **Package Manager:** pip

Install dependencies with:

```bash
pip install -r requirements.txt
```

Where `requirements.txt` lists:
```text
pyserial==3.5
imageio==2.26.0
opencv-python==4.8.0.74
numpy==1.26.4
matplotlib==3.7.0
pandas==1.5.3
```

## Installation

1. Clone the repository:
   ```bash
git clone https://github.com/yourusername/perovskite-experiment.git
cd perovskite-experiment
   ```
2. Install required packages:
   ```bash
pip install -r requirements.txt
   ```

## Usage

### 1. Pump Control (`send_pump_commands.py`)

```bash
python send_pump_commands.py -n "/2V1000EA0R"
```

- **-n, --name**: Command string to send to the pumps (e.g., `/2V1000EA0R` to set pump 2 to 1000 μL/min, enable A channel, etc.).
- Edit `puerto` and `baudrate` in the script if your COM port or baud rate differ.

### 2. Automated Photo Capture (`auto_image_capture.py`)

```bash
python auto_image_capture.py
```

- Captures an image from camera 0, waits 120 seconds, then from camera 1, and repeats indefinitely.
- Images saved as `foto_0_<timestamp>.jpg` and `foto_1_<timestamp>.jpg`.

### 3. Image Analysis (`PerovskiteGrowthAnalyzer.py`)

```bash
python PerovskiteGrowthAnalyzer.py
```

- Processes all `.jpg` files in the script directory.
- Detects contours in a fixed ROI, computes and smooths area over time.
- Outputs:
  - `processed_images/` folder with annotated images
  - `area_vs_time_plot.pdf` (growth curve)
  - `area_vs_time_data.txt` (tab-separated time, area data)

## Directory Structure

```
perovskite-experiment/
├── send_pump_commands.py
├── auto_image_capture.py
├── PerovskiteGrowthAnalyzer.py
├── requirements.txt
├── processed_images/      # generated by analysis script
├── area_vs_time_plot.pdf  # generated by analysis script
└── area_vs_time_data.txt  # generated by analysis script
```

## Outputs

1. **Pump Commands**: sent live to the Tricontinent pumps.
2. **Raw Photos**: timestamped `.jpg` files for each camera.
3. **Processed Images**: annotated snapshots in `processed_images/`.
4. **Growth Plot**: `area_vs_time_plot.pdf` showing perovskite area vs. time.
5. **Data File**: `area_vs_time_data.txt` with raw and smoothed area measurements.

## License

This project is licensed under the MIT License – see the [LICENSE](LICENSE) file for details.
